#!/bin/bash

# Prevent recursion
if [ "$JAVA_WRAPPER_RUNNING" = "1" ]; then
    echo "Error: Detected recursive call to java wrapper!" >&2
    exit 1
fi
export JAVA_WRAPPER_RUNNING=1

# Function to find the first "real" java binary in PATH
find_real_java() {
    IFS=':' read -ra dirs <<< "$PATH"
    for dir in "${dirs[@]}"; do
        candidate="$dir/java"
        candidate_path=$(realpath "$candidate" 2>/dev/null)
        if [ -x "$candidate_path" ] && [[ "$candidate_path" == /usr/* || "$candidate_path" == /bin/* ]]; then
            echo "$candidate_path"
            return 0
        fi
    done
    return 1
}

# Try to find real java
real_java=$(find_real_java)

if [ -n "$real_java" ]; then
    exec "$real_java" "$@"
else
    # Fallback to junest Java
    exec "$HOME/dotfiles/bin/junest" -- java "$@"
fi
